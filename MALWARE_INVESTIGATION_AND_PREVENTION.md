# ðŸš¨ Malware Investigation & Prevention Guide

## How the Malware Likely Got In

Based on the investigation, the `javs` malware most likely entered through:

### **Most Likely: SSH Brute Force Attack**

1. **Weak Password**: The server uses password authentication for SSH
2. **Exposed Port**: SSH port 22 is likely exposed to the internet
3. **Brute Force**: Attackers tried many password combinations until they got in
4. **Once Inside**: They installed the malware and set up persistence

### **Evidence Found:**

- Malware in `.bashrc` (auto-starts on login)
- Malware in crontab (`@reboot` entry)
- Process running: `/home/nomadadmin/.javs/javs/javs --daemonized`
- Another suspicious process: `/opt/nezha/agent/apphub-linux-amd64/apps/gaganode/gaganode`

## How to Investigate

Run this script to find the entry point:

```bash
cd /Users/zeshaanqureshi/Desktop/Nomad-Stop-NextJS
./find-malware-entry-point.sh
```

Or run these commands directly on the VPS:

```bash
ssh nomadadmin@92.205.231.55

# Check SSH login history
sudo last -50

# Check failed login attempts (brute force evidence)
sudo grep "Failed password" /var/log/auth.log | tail -50

# Check when malware was installed
stat ~/.bashrc.backup
ls -la ~/.bashrc

# Check for other suspicious processes
ps aux | grep -E "(gaganode|nezha|javs)"
```

## How to Prevent It From Coming Back

### **1. Disable SSH Password Authentication (CRITICAL)**

```bash
# On the VPS:
sudo nano /etc/ssh/sshd_config

# Change these lines:
PasswordAuthentication no
PermitRootLogin no

# Save and restart SSH
sudo systemctl restart sshd
```

### **2. Use SSH Keys Instead**

```bash
# On your Mac, generate SSH key if you don't have one:
ssh-keygen -t ed25519 -C "your_email@example.com"

# Copy your public key to the server:
ssh-copy-id nomadadmin@92.205.231.55

# Test that key-based login works
ssh nomadadmin@92.205.231.55
```

### **3. Set Up Firewall (UFW)**

```bash
# On the VPS:
sudo ufw default deny incoming
sudo ufw default allow outgoing
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable
sudo ufw status
```

### **4. Change SSH Port (Optional but Recommended)**

```bash
# Edit SSH config:
sudo nano /etc/ssh/sshd_config

# Change:
Port 2222  # Use a non-standard port

# Restart SSH:
sudo systemctl restart sshd

# Update firewall:
sudo ufw allow 2222/tcp
```

### **5. Install Fail2Ban (Prevents Brute Force)**

```bash
sudo apt update
sudo apt install fail2ban -y
sudo systemctl enable fail2ban
sudo systemctl start fail2ban
```

### **6. Remove Suspicious Services**

```bash
# Check what nezha/gaganode is:
ps aux | grep nezha
ls -la /opt/nezha

# If it's not needed, remove it:
sudo rm -rf /opt/nezha
```

### **7. Regular Security Checks**

Create a monitoring script to run daily:

```bash
# Check for malware processes
ps aux | grep -E "(javs|miner|xmrig)"

# Check for suspicious cron jobs
crontab -l
sudo crontab -l

# Check SSH access
sudo last -20
```

## Immediate Actions

1. **Run the investigation script** to see when/how it got in
2. **Disable password authentication** (use SSH keys only)
3. **Set up firewall** (UFW)
4. **Install fail2ban** (prevents brute force)
5. **Change all passwords** (SSH, database, etc.)
6. **Monitor for return** (check daily for malware processes)

## Signs the Malware is Back

- CPU usage at 100%
- Process named `javs` running
- Directory `/home/nomadadmin/.javs` exists
- Entries in `.bashrc` or crontab mentioning `javs`
- High network traffic to unknown IPs

## Quick Check Command

Run this daily to check if malware returned:

```bash
ps aux | grep javs | grep -v grep || echo "âœ… No malware"
ls -la ~/.javs 2>/dev/null || echo "âœ… No malware directory"
grep javs ~/.bashrc 2>/dev/null || echo "âœ… No malware in .bashrc"
crontab -l | grep javs || echo "âœ… No malware in crontab"
```

